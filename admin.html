<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate">
<title>NORLAB &mdash; Panel de Expedientes</title>
<style>
:root{
  --navy:#0b1f3a;--navy2:#132d52;--blue:#2D7EA8;--blue2:#2A5870;
  --teal:#4AB8C8;--light:#f7f9fc;--border:#e8edf5;--text:#0F2430;
  --muted:#6b7c93;--green:#2e7d32;--red:#c62828;--yellow:#b45309;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--light);color:var(--text);min-height:100vh;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes spin{to{transform:rotate(360deg)}}

/* NAV */
nav{background:var(--navy);padding:0 28px;height:62px;display:flex;align-items:center;justify-content:space-between;}
.nav-logo{height:42px;object-fit:contain;}
.nav-title{color:rgba(255,255,255,.6);font-size:13px;font-weight:600;letter-spacing:.5px;}

/* LOGIN */
#loginScreen{display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 62px);padding:24px;}
.login-box{background:#fff;border-radius:20px;padding:40px;width:100%;max-width:380px;border:1px solid var(--border);box-shadow:0 8px 40px rgba(0,0,0,.08);animation:fadeUp .3s ease;}
.login-box h2{font-size:20px;font-weight:700;color:var(--navy);margin-bottom:6px;}
.login-box p{font-size:13px;color:var(--muted);margin-bottom:24px;}
.login-box input{width:100%;border:1.5px solid var(--border);border-radius:10px;padding:11px 14px;font-size:14px;font-family:inherit;outline:none;margin-bottom:12px;}
.login-box input:focus{border-color:var(--blue);}
.btn-login{width:100%;background:var(--blue);color:#fff;border:none;border-radius:10px;padding:13px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;}
.btn-login:hover{background:var(--blue2);}
#loginErr{color:var(--red);font-size:12px;margin-top:8px;display:none;}

/* MAIN LAYOUT */
#mainScreen{display:none;animation:fadeUp .3s ease;}
.toolbar{background:#fff;border-bottom:1px solid var(--border);padding:14px 28px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.toolbar-title{font-size:16px;font-weight:700;color:var(--navy);flex:1;}
.search-box{display:flex;align-items:center;gap:8px;background:var(--light);border:1.5px solid var(--border);border-radius:10px;padding:8px 12px;min-width:240px;}
.search-box input{border:none;background:none;font-size:13px;font-family:inherit;outline:none;width:100%;}
.filter-sel{border:1.5px solid var(--border);border-radius:10px;padding:8px 12px;font-size:13px;font-family:inherit;background:#fff;outline:none;color:var(--text);cursor:pointer;}
.btn-refresh{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:9px 16px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;display:flex;align-items:center;gap:6px;}
.btn-refresh:hover{background:var(--blue2);}

/* STATS BAR */
.stats-bar{padding:16px 28px;display:flex;gap:12px;flex-wrap:wrap;}
.stat-card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px 18px;min-width:140px;flex:1;}
.stat-n{font-size:28px;font-weight:800;color:var(--navy);line-height:1;}
.stat-l{font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;text-transform:uppercase;letter-spacing:.6px;}
.stat-card.green{border-color:#a5d6a7;background:#f1f8e9;} .stat-card.green .stat-n{color:var(--green);}
.stat-card.yellow{border-color:#ffe082;background:#fffde7;} .stat-card.yellow .stat-n{color:var(--yellow);}
.stat-card.red{border-color:#ef9a9a;background:#ffebee;} .stat-card.red .stat-n{color:var(--red);}
.stat-card.blue{border-color:#90caf9;background:#e3f2fd;} .stat-card.blue .stat-n{color:var(--blue);}

/* TABLE */
.table-wrap{padding:0 28px 28px;overflow-x:auto;}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:14px;overflow:hidden;border:1px solid var(--border);}
th{background:var(--navy);color:#fff;padding:11px 14px;font-size:11px;font-weight:700;text-align:left;letter-spacing:.5px;text-transform:uppercase;white-space:nowrap;}
td{padding:11px 14px;font-size:13px;border-bottom:1px solid var(--border);vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:#f8fafc;cursor:pointer;}
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:700;white-space:nowrap;}
.badge-green{background:#e8f5e9;color:var(--green);}
.badge-yellow{background:#fff8e1;color:var(--yellow);}
.badge-red{background:#ffebee;color:var(--red);}
.badge-blue{background:#e3f2fd;color:var(--blue);}
.badge-gray{background:#f5f5f5;color:#666;}
.score-bar{display:flex;align-items:center;gap:8px;}
.score-track{flex:1;height:6px;background:#e8edf5;border-radius:3px;min-width:60px;}
.score-fill{height:100%;border-radius:3px;transition:width .3s;}
.btn-row-sm{display:flex;gap:6px;}

/* DETAIL PANEL */
#detailOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:200;}
#detailPanel{position:fixed;right:0;top:0;bottom:0;width:520px;max-width:95vw;background:#fff;box-shadow:-4px 0 32px rgba(0,0,0,.15);overflow-y:auto;z-index:201;animation:slideIn .25s ease;}
@keyframes slideIn{from{transform:translateX(100%)}to{transform:none}}
.dp-head{background:var(--navy);padding:20px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10;}
.dp-head h3{color:#fff;font-size:16px;font-weight:700;}
.dp-close{background:none;border:none;color:rgba(255,255,255,.7);cursor:pointer;font-size:22px;line-height:1;padding:2px 6px;}
.dp-close:hover{color:#fff;}
.dp-body{padding:20px 24px;}
.dp-section{margin-bottom:20px;}
.dp-section-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:6px;}
.dp-row{display:flex;justify-content:space-between;padding:6px 0;font-size:13px;border-bottom:1px solid #f5f7fa;}
.dp-row:last-child{border-bottom:none;}
.dp-row span:first-child{color:var(--muted);flex:0 0 160px;}
.dp-row span:last-child{font-weight:600;text-align:right;flex:1;}
.score-big{text-align:center;padding:20px;background:var(--light);border-radius:12px;margin-bottom:16px;}
.score-big .sn{font-size:48px;font-weight:900;line-height:1;}
.score-big .sl{font-size:13px;color:var(--muted);margin-top:6px;}
.score-big .rec{margin-top:10px;font-size:13px;font-weight:600;}
.status-select{border:1.5px solid var(--border);border-radius:9px;padding:9px 12px;font-size:13px;font-family:inherit;width:100%;margin-bottom:8px;background:#fff;}
.nota-input{border:1.5px solid var(--border);border-radius:9px;padding:9px 12px;font-size:13px;font-family:inherit;width:100%;min-height:72px;resize:vertical;}
.btn-save{background:var(--blue);color:#fff;border:none;border-radius:9px;padding:10px 20px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;width:100%;margin-top:8px;}
.btn-save:hover{background:var(--blue2);}
.file-item{display:flex;align-items:center;gap:10px;padding:8px 10px;border:1px solid var(--border);border-radius:8px;margin-bottom:6px;font-size:12px;}
.file-item a{color:var(--blue);text-decoration:none;font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.file-item a:hover{text-decoration:underline;}
.btn-drive{display:flex;align-items:center;gap:6px;background:#e3f2fd;color:var(--blue2);border:1px solid #90caf9;border-radius:8px;padding:8px 14px;font-size:12px;font-weight:700;text-decoration:none;margin-bottom:12px;}
.empty-state{text-align:center;padding:48px 20px;color:var(--muted);}
.loading-spinner{display:flex;align-items:center;justify-content:center;gap:10px;padding:48px;color:var(--muted);font-size:14px;}
.notes-log{background:var(--light);border-radius:8px;padding:10px 12px;font-size:12px;color:var(--muted);white-space:pre-wrap;line-height:1.6;max-height:120px;overflow-y:auto;margin-bottom:8px;}
</style>
</head>
<body>

<nav>
  <img class="nav-logo" src="data:image/png;base64,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" alt="NORLAB">
  <span class="nav-title">Panel de Expedientes</span>
</nav>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <h2>Acceso al panel</h2>
    <p>Ingresa la contrase&ntilde;a de administrador para continuar.</p>
    <input type="password" id="pwdInput" placeholder="Contrase&ntilde;a" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="btn-login" onclick="doLogin()">Ingresar</button>
    <div id="loginErr">Contrase&ntilde;a incorrecta</div>
  </div>
</div>

<!-- MAIN -->
<div id="mainScreen">
  <div class="toolbar">
    <div class="toolbar-title">
      <svg viewBox="0 0 24 24" width="18" height="18" stroke="#2A5870" stroke-width="1.8" fill="none" style="vertical-align:middle;margin-right:6px"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg>
      Solicitudes de Financiamiento
    </div>
    <div class="search-box">
      <svg viewBox="0 0 24 24" width="15" height="15" stroke="#6b7c93" stroke-width="2" fill="none"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="searchInput" placeholder="Buscar por nombre, folio, equipo..." oninput="filterTable()">
    </div>
    <select class="filter-sel" id="filterEstado" onchange="filterTable()">
      <option value="">Todos los estados</option>
      <option>Pendiente</option>
      <option>En revisi&oacute;n</option>
      <option>Docs incompletos</option>
      <option>Pre-aprobado</option>
      <option>Aprobado</option>
      <option>Rechazado</option>
    </select>
    <select class="filter-sel" id="filterPlan" onchange="filterTable()">
      <option value="">Todos los planes</option>
      <option>Financiamiento</option>
      <option>Renta mensual</option>
      <option>Comodato</option>
    </select>
    <button class="btn-refresh" onclick="loadData()">
      <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2.5" fill="none"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      Actualizar
    </button>
  </div>

  <div class="stats-bar" id="statsBar"></div>

  <div class="table-wrap">
    <div id="tableArea"><div class="loading-spinner"><svg viewBox="0 0 24 24" width="20" height="20" stroke="#2A5870" stroke-width="2" fill="none" style="animation:spin .8s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Cargando...</div></div>
  </div>
</div>

<!-- DETAIL PANEL -->
<div id="detailOverlay" onclick="closeDetail()" style="display:none"></div>
<div id="detailPanel" style="display:none">
  <div class="dp-head">
    <h3 id="dp-title">Detalle de solicitud</h3>
    <button class="dp-close" onclick="closeDetail()">&times;</button>
  </div>
  <div class="dp-body" id="dp-body">
    <div class="loading-spinner"><svg viewBox="0 0 24 24" width="20" height="20" stroke="#2A5870" stroke-width="2" fill="none" style="animation:spin .8s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Cargando...</div>
  </div>
</div>

<script>
const SCRIPT = 'https://script.google.com/macros/s/AKfycbwzmTfquFIe_uHnTxsDFHrtuQw_1c9QZlIsV8bjdqPKM1d5IRouqe33192VLAM8twHq/exec';
var allRows = [], userPwd = '';

// â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin(){
  var pwd = document.getElementById('pwdInput').value;
  if(!pwd)return;
  var btn = document.querySelector('.btn-login');
  var err = document.getElementById('loginErr');
  err.style.display='none';
  btn.disabled=true; btn.textContent='Verificando...';
  callScript({action:'admin_list',pwd:pwd}, function(data){
    btn.disabled=false; btn.textContent='Ingresar';
    if(data.error){
      err.textContent = data.error==='No autorizado' ? 'ContraseÃ±a incorrecta' : 'Error de conexiÃ³n: '+data.error;
      err.style.display='block';
    }else{
      userPwd=pwd;
      document.getElementById('loginScreen').style.display='none';
      document.getElementById('mainScreen').style.display='block';
      allRows=data.rows||[];
      renderStats();
      renderTable(allRows);
    }
  });
}

// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadData(){
  document.getElementById('tableArea').innerHTML='<div class="loading-spinner"><svg viewBox="0 0 24 24" width="20" height="20" stroke="#2A5870" stroke-width="2" fill="none" style="animation:spin .8s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Actualizando...</div>';
  callScript({action:'admin_list',pwd:userPwd}, function(data){
    allRows=data.rows||[];
    renderStats();
    filterTable();
  });
}

function callScript(params, cb){
  var cb_name='_cb'+Date.now();
  var sc=document.createElement('script');
  var to=setTimeout(function(){cleanup();cb({error:'Timeout'});},12000);
  window[cb_name]=function(d){clearTimeout(to);cleanup();cb(d);};
  var qs=Object.keys(params).map(function(k){return encodeURIComponent(k)+'='+encodeURIComponent(params[k]);}  ).join('&');
  sc.src=SCRIPT+'?'+qs+'&callback='+cb_name+'&ts='+Date.now();
  sc.onerror=function(){clearTimeout(to);cleanup();cb({error:'Error de conexiÃ³n'});};
  document.head.appendChild(sc);
  function cleanup(){if(document.head.contains(sc))document.head.removeChild(sc);delete window[cb_name];}
}

// â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStats(){
  var total=allRows.length;
  var pendiente=allRows.filter(function(r){return (r['Estado']||'Pendiente')==='Pendiente';}).length;
  var aprobado=allRows.filter(function(r){return r['Estado']==='Aprobado'||r['Estado']==='Pre-aprobado';}).length;
  var revision=allRows.filter(function(r){return r['Estado']==='En revisiÃ³n'||r['Estado']==='En revisi\u00f3n';}).length;
  var rechazado=allRows.filter(function(r){return r['Estado']==='Rechazado';}).length;
  var avgScore=total>0?Math.round(allRows.reduce(function(s,r){return s+(Number(r['Score'])||0);},0)/total):0;

  document.getElementById('statsBar').innerHTML=
    stat(total,'Total solicitudes','blue')+
    stat(pendiente,'Pendientes','yellow')+
    stat(revision,'En revisiÃ³n','blue')+
    stat(aprobado,'Pre-aprobados / Aprobados','green')+
    stat(rechazado,'Rechazados','red')+
    stat(avgScore,'Score promedio','blue');
}
function stat(n,l,cls){
  return '<div class="stat-card '+cls+'"><div class="stat-n">'+n+'</div><div class="stat-l">'+l+'</div></div>';
}

// â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterTable(){
  var q=(document.getElementById('searchInput').value||'').toLowerCase();
  var est=document.getElementById('filterEstado').value;
  var plan=document.getElementById('filterPlan').value;
  var filtered=allRows.filter(function(r){
    var matchQ=!q||(r['Folio']||'').toLowerCase().includes(q)||(r['Nombre / RazÃ³n Social']||'').toLowerCase().includes(q)||(r['Equipo']||'').toLowerCase().includes(q)||(r['Email']||'').toLowerCase().includes(q)||(r['Ciudad']||'').toLowerCase().includes(q);
    var matchE=!est||(r['Estado']||'Pendiente')===est;
    var matchP=!plan||(r['Plan']||'')===plan;
    return matchQ&&matchE&&matchP;
  });
  renderTable(filtered);
}

function renderTable(rows){
  if(!rows.length){
    document.getElementById('tableArea').innerHTML='<div class="empty-state"><svg viewBox="0 0 24 24" width="48" height="48" stroke="#ccc" stroke-width="1.5" fill="none"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg><br>No hay solicitudes que coincidan</div>';
    return;
  }
  var html='<table><thead><tr>'+
    '<th>Folio</th><th>Fecha</th><th>Cliente</th><th>Equipo</th><th>Plan</th>'+
    '<th>Score</th><th>Estado</th><th>Docs</th><th>Ciudad</th>'+
    '</tr></thead><tbody>';

  rows.forEach(function(r){
    var folio=r['Folio']||'';
    var fecha=(r['Fecha']||'').toString().substr(0,10);
    var nombre=r['Nombre / RazÃ³n Social']||'';
    var equipo=r['Equipo']||'';
    var plan=r['Plan']||'';
    var score=Number(r['Score'])||0;
    var estado=r['Estado']||'Pendiente';
    var docsOk=Number(r['Docs OK'])||0;
    var docsReq=Number(r['Docs Req'])||4;
    var ciudad=r['Ciudad']||'';
    var email=r['Email']||'';

    var scoreCls=score>=70?'#2e7d32':score>=40?'#b45309':'#c62828';
    var estadoBadge=badgeEstado(estado);
    var docsBadge=docsOk>=docsReq?
      '<span class="badge badge-green"><svg viewBox="0 0 24 24" width="10" height="10" stroke="currentColor" stroke-width="2.5" fill="none"><polyline points="20 6 9 17 4 12"/></svg>'+docsOk+'/'+docsReq+'</span>':
      '<span class="badge badge-yellow">'+docsOk+'/'+docsReq+'</span>';

    html+='<tr onclick="openDetail(''+folio+'')">'+
      '<td><strong style="color:var(--navy)">'+folio+'</strong></td>'+
      '<td style="color:var(--muted)">'+fecha+'</td>'+
      '<td><div style="font-weight:600">'+nombre+'</div><div style="font-size:11px;color:var(--muted)">'+email+'</div></td>'+
      '<td>'+equipo+'</td>'+
      '<td><span style="font-size:12px">'+plan+'</span></td>'+
      '<td><div class="score-bar"><strong style="color:'+scoreCls+';font-size:15px;min-width:28px">'+score+'</strong><div class="score-track"><div class="score-fill" style="width:'+Math.min(score,100)+'%;background:'+scoreCls+'"></div></div></div></td>'+
      '<td>'+estadoBadge+'</td>'+
      '<td>'+docsBadge+'</td>'+
      '<td style="color:var(--muted);font-size:12px">'+ciudad+'</td>'+
      '</tr>';
  });
  html+='</tbody></table>';
  document.getElementById('tableArea').innerHTML=html;
}

function badgeEstado(e){
  var map={
    'Pendiente':       'badge-yellow',
    'En revisiÃ³n':     'badge-blue',
    'En revisi\u00f3n':'badge-blue',
    'Docs incompletos':'badge-yellow',
    'Pre-aprobado':    'badge-green',
    'Aprobado':        'badge-green',
    'Rechazado':       'badge-red',
  };
  return '<span class="badge '+(map[e]||'badge-gray')+'">'+e+'</span>';
}

// â”€â”€ Detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openDetail(folio){
  document.getElementById('detailOverlay').style.display='block';
  document.getElementById('detailPanel').style.display='block';
  document.getElementById('dp-title').textContent=folio;
  document.getElementById('dp-body').innerHTML='<div class="loading-spinner"><svg viewBox="0 0 24 24" width="20" height="20" stroke="#2A5870" stroke-width="2" fill="none" style="animation:spin .8s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Cargando detalle...</div>';

  callScript({action:'admin_detail',pwd:userPwd,folio:folio}, function(d){
    if(d.error){document.getElementById('dp-body').innerHTML='<p style="color:red;padding:20px">'+d.error+'</p>';return;}
    renderDetail(d);
  });
}
function closeDetail(){
  document.getElementById('detailOverlay').style.display='none';
  document.getElementById('detailPanel').style.display='none';
}

function renderDetail(d){
  var score=Number(d['Score'])||0;
  var rec=d['Recomendaci\u00f3n']||d['Recomendacion']||'';
  var scoreCls=score>=70?'var(--green)':score>=40?'var(--yellow)':'var(--red)';
  var recIcon=score>=70?'âœ“':score>=40?'~':'âœ—';

  // Files
  var filesHtml='';
  if(d._drive_url){
    filesHtml+='<a class="btn-drive" href="'+d._drive_url+'" target="_blank">'+
      '<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="1.8" fill="none"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>'+
      'Abrir carpeta en Drive</a>';
  }
  var files=d._files||[];
  if(files.length){
    files.forEach(function(f){
      var ext=(f.name||'').split('.').pop().toUpperCase();
      filesHtml+='<div class="file-item">'+
        '<svg viewBox="0 0 24 24" width="16" height="16" stroke="#2A5870" stroke-width="1.8" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>'+
        '<a href="'+f.url+'" target="_blank">'+f.name+'</a>'+
        '<span style="font-size:10px;color:var(--muted);background:#f5f5f5;padding:2px 6px;border-radius:4px">'+ext+'</span>'+
        '</div>';
    });
  }else{
    filesHtml+='<p style="font-size:12px;color:var(--muted)">No hay documentos subidos a&uacute;n.</p>';
  }

  // Notes log
  var notas=d['Notas']||'';
  var notasHtml=notas?'<div class="notes-log">'+notas+'</div>':'';

  var html=
    // Score
    '<div class="score-big">'+
      '<div class="sn" style="color:'+scoreCls+'">'+score+'<span style="font-size:20px;color:var(--muted)">/100</span></div>'+
      '<div class="sl">Score de evaluaci&oacute;n autom&aacute;tica</div>'+
      '<div class="rec" style="color:'+scoreCls+'">'+recIcon+' '+rec.replace(/âœ…|ðŸŸ¡|ðŸ”´/g,'').trim()+'</div>'+
    '</div>'+

    // Plan
    '<div class="dp-section">'+
    '<div class="dp-section-title"><svg viewBox="0 0 24 24" width="13" height="13" stroke="currentColor" stroke-width="2" fill="none"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg> Plan solicitado</div>'+
    row2('Equipo', d['Equipo'])+row2('Plan', d['Plan'])+row2('Plazo', d['Plazo']?d['Plazo']+' meses':'')+row2('Mensualidad', d['Mensualidad'])+row2('Enganche', d['Enganche'])+
    '</div>'+

    // Cliente
    '<div class="dp-section">'+
    '<div class="dp-section-title"><svg viewBox="0 0 24 24" width="13" height="13" stroke="currentColor" stroke-width="2" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Solicitante</div>'+
    row2('Nombre', d['Nombre / Raz\u00f3n Social']||d['Nombre / Razon Social'])+row2('Tipo', d['Tipo'])+row2('RFC', d['RFC'])+row2('Tel\u00e9fono', d['Tel\u00e9fono']||d['Telefono'])+row2('Email', d['Email'])+row2('Ciudad', d['Ciudad'])+row2('Negocio', d['Negocio / Empresa'])+row2('Antig\u00fcedad', d['A\u00f1os operaci\u00f3n']||d['Anos operacion'])+
    '</div>'+

    // Zoho
    '<div class="dp-section">'+
    '<div class="dp-section-title"><svg viewBox="0 0 24 24" width="13" height="13" stroke="currentColor" stroke-width="2" fill="none"><path d="M3 3h18v18H3z"/><path d="M3 9h18M3 15h18M9 3v18"/></svg> Historial Zoho</div>'+
    row2('Cliente verificado', d['Zoho: Cliente'])+row2('Total compras', d['Zoho: Total compras']?'$'+Number(d['Zoho: Total compras']).toLocaleString('es-MX'):'')+row2('Facturas pagadas', d['Zoho: Facturas pagadas'])+row2('\u00daltima compra', d['Zoho: \u00daltima compra']||d['Zoho: Ultima compra'])+row2('Saldo pendiente', d['Zoho: Saldo pendiente']>0?'<span style="color:var(--red);font-weight:700">$'+Number(d['Zoho: Saldo pendiente']).toLocaleString('es-MX')+'</span>':'$0')+
    '</div>'+

    // Docs
    '<div class="dp-section">'+
    '<div class="dp-section-title"><svg viewBox="0 0 24 24" width="13" height="13" stroke="currentColor" stroke-width="2" fill="none"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg> Documentos</div>'+
    filesHtml+
    '</div>'+

    // Status change
    '<div class="dp-section">'+
    '<div class="dp-section-title"><svg viewBox="0 0 24 24" width="13" height="13" stroke="currentColor" stroke-width="2" fill="none"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg> Cambiar estado</div>'+
    notasHtml+
    '<select id="dp_status" class="status-select">'+
      '<option value="">-- Selecciona nuevo estado --</option>'+
      '<option value="Pendiente">Pendiente</option>'+
      '<option value="En revisi\u00f3n">En revisi\u00f3n</option>'+
      '<option value="Docs incompletos">Docs incompletos</option>'+
      '<option value="Pre-aprobado">Pre-aprobado</option>'+
      '<option value="Aprobado">Aprobado</option>'+
      '<option value="Rechazado">Rechazado</option>'+
    '</select>'+
    '<textarea id="dp_nota" class="nota-input" placeholder="Agregar nota interna (opcional)..."></textarea>'+
    '<button class="btn-save" onclick="saveStatus(''+d['Folio']+'')">Guardar cambio de estado</button>'+
    '</div>';

  document.getElementById('dp-body').innerHTML=html;

  // Set current status
  var sel=document.getElementById('dp_status');
  if(sel){
    for(var i=0;i<sel.options.length;i++){
      if(sel.options[i].value===(d['Estado']||'Pendiente')){sel.selectedIndex=i;break;}
    }
  }
}

function row2(l,v){
  if(!v&&v!==0) return '';
  return '<div class="dp-row"><span>'+l+'</span><span>'+v+'</span></div>';
}

function saveStatus(folio){
  var status=document.getElementById('dp_status').value;
  var nota=document.getElementById('dp_nota').value;
  if(!status){alert('Selecciona un estado');return;}
  var btn=document.querySelector('.btn-save');
  if(btn){btn.disabled=true;btn.textContent='Guardando...';}

  callScript({action:'admin_status',pwd:userPwd,folio:folio,status:status,nota:nota},function(d){
    if(d.ok){
      // Update local row
      allRows.forEach(function(r){if(r['Folio']===folio)r['Estado']=status;});
      renderStats();
      filterTable();
      closeDetail();
    }else{
      alert('Error: '+(d.error||'desconocido'));
      if(btn){btn.disabled=false;btn.textContent='Guardar cambio de estado';}
    }
  });
}

// Auto-load on page open (if pwd saved in session)
window.onload = function(){
  document.getElementById('pwdInput').focus();
};
</script>
</body>
</html>